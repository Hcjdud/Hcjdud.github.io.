<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Myxa VPN</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        body {
            background: #0a0b0e;
            color: white;
            min-height: 100vh;
        }
        .app {
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
            padding-bottom: 80px;
        }
        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .logo {
            font-size: 24px;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .balance-card {
            background: #1a1b1f;
            padding: 10px 15px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .balance-icon {
            width: 30px;
            height: 30px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .balance-amount {
            font-size: 18px;
            font-weight: bold;
        }
        .balance-currency {
            color: #667eea;
        }
        /* Lucky Button */
        .lucky-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            color: white;
            width: 100%;
            padding: 20px;
            border-radius: 20px;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .lucky-btn:active {
            transform: scale(0.98);
        }
        .lucky-subtitle {
            font-size: 14px;
            opacity: 0.9;
            margin-top: 5px;
        }
        /* Grid */
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        .grid-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        /* Cards */
        .card {
            background: #1a1b1f;
            padding: 20px;
            border-radius: 20px;
            margin-bottom: 20px;
        }
        .card-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
        }
        .price-card {
            background: #1a1b1f;
            padding: 15px;
            border-radius: 15px;
            border: 1px solid #2a2b2f;
        }
        .price {
            font-size: 20px;
            font-weight: bold;
            color: #667eea;
            margin: 10px 0;
        }
        .price-old {
            text-decoration: line-through;
            opacity: 0.5;
            font-size: 14px;
        }
        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            color: white;
            padding: 12px;
            border-radius: 12px;
            width: 100%;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        .btn:active {
            opacity: 0.8;
        }
        .btn-outline {
            background: transparent;
            border: 1px solid #667eea;
        }
        .btn-small {
            padding: 8px;
            font-size: 14px;
        }
        /* Inputs */
        .input-group {
            margin-bottom: 15px;
        }
        .input-label {
            display: block;
            margin-bottom: 5px;
            opacity: 0.8;
        }
        .input-field {
            width: 100%;
            padding: 12px;
            background: #2a2b2f;
            border: 1px solid #3a3b3f;
            border-radius: 12px;
            color: white;
            font-size: 16px;
        }
        .input-field:focus {
            outline: none;
            border-color: #667eea;
        }
        /* Tabs */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .tab {
            flex: 1;
            padding: 12px;
            background: #1a1b1f;
            border: none;
            color: white;
            border-radius: 12px;
            cursor: pointer;
        }
        .tab.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }
        /* Admin */
        .admin-panel {
            background: #1a1b1f;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .user-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #2a2b2f;
            border-radius: 12px;
            margin-bottom: 10px;
        }
        .badge {
            background: #ff6b6b;
            padding: 4px 8px;
            border-radius: 8px;
            font-size: 12px;
        }
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .modal.active {
            display: flex;
        }
        .modal-content {
            background: #1a1b1f;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 400px;
        }
        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #1a1b1f;
            display: flex;
            justify-content: space-around;
            padding: 12px;
            border-top: 1px solid #2a2b2f;
        }
        .nav-item {
            color: white;
            text-decoration: none;
            opacity: 0.6;
            font-size: 14px;
        }
        .nav-item.active {
            opacity: 1;
            color: #667eea;
        }
        /* Chat */
        .chat-messages {
            height: 300px;
            overflow-y: auto;
            background: #2a2b2f;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 15px;
        }
        .message {
            margin-bottom: 10px;
            padding: 10px;
            border-radius: 10px;
        }
        .message.user {
            background: #667eea;
            margin-left: 20%;
        }
        .message.admin {
            background: #1a1b1f;
            margin-right: 20%;
        }
        .message-time {
            font-size: 10px;
            opacity: 0.6;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="app" id="app">
        <!-- –•–µ–¥–µ—Ä -->
        <div class="header">
            <div class="logo">myxa vpn</div>
            <div class="balance-card">
                <div class="balance-icon">üí∞</div>
                <div>
                    <span class="balance-amount" id="balanceDisplay">0</span>
                    <span class="balance-currency">‚ÇΩ</span>
                </div>
            </div>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∞ —É–¥–∞—á–∏ -->
        <button class="lucky-btn" onclick="openCase()">
            üé≤ –ò–°–ü–´–¢–ê–¢–¨ –£–î–ê–ß–£
            <div class="lucky-subtitle">–í–´–ò–ì–†–ê–ô –î–û 10 000‚ÇΩ</div>
        </button>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç –±—É–¥–µ—Ç –º–µ–Ω—è—Ç—å—Å—è —á–µ—Ä–µ–∑ –≤–∫–ª–∞–¥–∫–∏ -->
        <div id="content"></div>

        <!-- –ù–∏–∂–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è -->
        <div class="bottom-nav">
            <a href="#" class="nav-item active" onclick="switchTab('account')">–ê–ö–ö–ê–£–ù–¢</a>
            <a href="#" class="nav-item" onclick="switchTab('tariffs')">–¢–ê–†–ò–§–´</a>
            <a href="#" class="nav-item" onclick="switchTab('help')">–ü–û–ú–û–©–¨</a>
        </div>
    </div>

    <script>
        // ===============================
        // –ë–ê–ó–ê –î–ê–ù–ù–´–•
        // ===============================
        let DB = {
            users: [],
            currentUser: null,
            admin: {
                login: 'admin',
                password: 'admin123',
                isLoggedIn: false
            },
            supportChats: [],
            nextUserId: 1000
        };

        // ===============================
        // –ó–ê–ì–†–£–ó–ö–ê –ü–†–ò –ó–ê–ü–£–°–ö–ï
        // ===============================
        function init() {
            // –°–æ–∑–¥–∞—ë–º —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const userId = localStorage.getItem('userId') || 'user_' + Date.now();
            let user = DB.users.find(u => u.id === userId);
            
            if (!user) {
                user = {
                    id: userId,
                    name: '–ì–æ—Å—Ç—å_' + Math.floor(Math.random() * 1000),
                    balance: 4,
                    ip: '–∑–∞–≥—Ä—É–∑–∫–∞...',
                    city: '–∑–∞–≥—Ä—É–∑–∫–∞...',
                    isBanned: false,
                    refCode: 'ref_' + Math.random().toString(36).substring(2, 10),
                    refBalance: 0,
                    refCount: 0,
                    subscriptions: [],
                    transactions: [],
                    messages: []
                };
                
                // –ü–æ–ª—É—á–∞–µ–º IP (—á–µ—Ä–µ–∑ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–µ API)
                fetch('https://ipapi.co/json/')
                    .then(r => r.json())
                    .then(data => {
                        user.ip = data.ip;
                        user.city = data.city;
                    });
                
                DB.users.push(user);
                localStorage.setItem('userId', userId);
            }
            
            DB.currentUser = user;
            
            // –ì—Ä—É–∑–∏–º —á–∞—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏
            const chats = localStorage.getItem('supportChats');
            if (chats) DB.supportChats = JSON.parse(chats);
            
            updateUI();
        }

        // ===============================
        // –û–ë–ù–û–í–õ–ï–ù–ò–ï –ò–ù–¢–ï–†–§–ï–ô–°–ê
        // ===============================
        function updateUI() {
            document.getElementById('balanceDisplay').textContent = DB.currentUser.balance;
            switchTab('account');
        }

        // ===============================
        // –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–ï –í–ö–õ–ê–î–û–ö
        // ===============================
        function switchTab(tab) {
            const content = document.getElementById('content');
            const navItems = document.querySelectorAll('.nav-item');
            
            navItems.forEach(item => item.classList.remove('active'));
            event.target.classList.add('active');
            
            if (tab === 'account') showAccount();
            else if (tab === 'tariffs') showTariffs();
            else if (tab === 'help') showHelp();
        }

        // ===============================
        // –°–¢–†–ê–ù–ò–¶–ê –ê–ö–ö–ê–£–ù–¢–ê
        // ===============================
        function showAccount() {
            const u = DB.currentUser;
            const activeSubs = u.subscriptions.filter(s => new Date(s.until) > new Date());
            
            let html = `
                <div class="card">
                    <div class="user-row">
                        <div>
                            <div style="font-size: 12px; opacity:0.6;">–í–ê–® ID: ${u.id}</div>
                            <div style="font-size: 14px;">üë§ ${u.name}</div>
                            <div style="font-size: 12px; opacity:0.6;">IP: ${u.ip} (${u.city})</div>
                        </div>
                        <div>
                            <span class="badge">${u.isBanned ? '–ó–ê–ë–ê–ù–ï–ù' : '–ê–ö–¢–ò–í–ï–ù'}</span>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">–ê–ö–¢–ò–í–ù–´–ï –ü–û–î–ü–ò–°–ö–ò (${activeSubs.length})</div>
            `;
            
            if (activeSubs.length === 0) {
                html += `<div style="opacity:0.6;">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–æ–∫</div>`;
            } else {
                activeSubs.forEach(sub => {
                    html += `
                        <div class="price-card" style="margin-bottom:10px;">
                            <div style="display:flex; justify-content:space-between;">
                                <span><strong>${sub.name}</strong></span>
                                <span style="color:#ff6b6b; cursor:pointer;" onclick="cancelSub('${sub.id}')">–£–¥–∞–ª–∏—Ç—å</span>
                            </div>
                            <div style="font-size:14px; opacity:0.6;">–î–æ: ${sub.until}</div>
                            <div style="margin:10px 0;">
                                <small>–°–°–´–õ–ö–ê –ù–ê –ü–û–î–ü–ò–°–ö–£</small>
                                <div style="background:#2a2b2f; padding:10px; border-radius:8px; font-size:12px;">
                                    https://sub.myxavpn.com/${sub.config}
                                </div>
                            </div>
                            <button class="btn btn-small" onclick="copyToClipboard('https://sub.myxavpn.com/${sub.config}')">
                                –ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å
                            </button>
                            <div style="margin-top:10px; font-size:12px;">
                                –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–æ–¥–ª–µ–Ω–∏–µ
                                <br>–°–ª–µ–¥—É—é—â–µ–µ —Å–ø–∏—Å–∞–Ω–∏–µ: ${sub.until}
                            </div>
                        </div>
                    `;
                });
            }
            
            html += `</div>`;
            
            // –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞
            html += `
                <div class="card">
                    <div class="card-title">–¢–í–û–Ø –†–ï–§–ï–†–ê–õ–¨–ù–ê–Ø –°–°–´–õ–ö–ê</div>
                    <div style="background:#2a2b2f; padding:10px; border-radius:8px; font-size:12px; margin-bottom:10px;">
                        ${window.location.origin}?ref=${u.refCode}
                    </div>
                    <button class="btn btn-small" onclick="copyToClipboard('${window.location.origin}?ref=${u.refCode}')">
                        ‚úàÔ∏è –ü–û–î–ï–õ–ò–¢–¨–°–Ø –° –î–†–£–ì–û–ú
                    </button>
                    <div style="margin-top:10px; font-size:12px;">
                        –ü—Ä–∏–≥–ª–∞—à–µ–Ω–æ –¥—Ä—É–∑–µ–π: ${u.refCount} | –ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ: ${u.refBalance}‚ÇΩ
                    </div>
                </div>
            `;
            
            // –ö–Ω–æ–ø–∫–∞ –∞–¥–º–∏–Ω–∫–∏
            if (DB.admin.isLoggedIn) {
                html += `
                    <button class="btn" onclick="showAdminPanel()" style="margin-top:20px;">
                        üëë –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–¨
                    </button>
                `;
            }
            
            document.getElementById('content').innerHTML = html;
        }

        // ===============================
        // –°–¢–†–ê–ù–ò–¶–ê –¢–ê–†–ò–§–û–í
        // ===============================
        function showTariffs() {
            const html = `
                <div class="grid-3">
                    <div class="price-card">
                        <div>PRO</div>
                        <div class="price">91‚ÇΩ</div>
                        <div style="font-size:12px; opacity:0.6;">–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</div>
                        <button class="btn btn-small" style="margin-top:10px;" onclick="buyTariff('pro')">–ö—É–ø–∏—Ç—å</button>
                    </div>
                    <div class="price-card">
                        <div>MAX</div>
                        <div class="price">120‚ÇΩ</div>
                        <div style="font-size:12px; opacity:0.6;">–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ+–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</div>
                        <button class="btn btn-small" style="margin-top:10px;" onclick="buyTariff('max')">–ö—É–ø–∏—Ç—å</button>
                    </div>
                    <div class="price-card">
                        <div>ROUTER</div>
                        <div class="price">8 000‚ÇΩ</div>
                        <div style="font-size:12px; opacity:0.6;">VPN —Ä–æ—É—Ç–µ—Ä</div>
                        <button class="btn btn-small" style="margin-top:10px;" onclick="buyTariff('router')">–ö—É–ø–∏—Ç—å</button>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-title">FREE</div>
                    <p>–ü–æ–ª—É—á–∏ –ø–æ–¥–ø–∏—Å–∫—É –±–µ—Å–ø–ª–∞—Ç–Ω–æ</p>
                    <p style="font-size:12px; opacity:0.6;">
                        –ó–∞ –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∫–æ—Ç–æ—Ä—ã–π –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –±–æ—Ç–∞ –ø–æ —Ç–≤–æ–µ–π —Å—Å—ã–ª–∫–µ, 
                        —Ç—ã –ø–æ–ª—É—á–∞–µ—à—å 50 ‚ÇΩ –Ω–∞ –±–∞–ª–∞–Ω—Å.
                    </p>
                </div>
            `;
            document.getElementById('content').innerHTML = html;
        }

        // ===============================
        // –°–¢–†–ê–ù–ò–¶–ê –ü–û–ú–û–©–ò
        // ===============================
        function showHelp() {
            const u = DB.currentUser;
            const chat = DB.supportChats.find(c => c.userId === u.id) || {
                userId: u.id,
                messages: []
            };
            
            let html = `
                <div class="card">
                    <div class="card-title">–ß–ê–¢ –° –ü–û–î–î–ï–†–ñ–ö–û–ô</div>
                    <div class="chat-messages" id="chatMessages">
            `;
            
            chat.messages.forEach(msg => {
                html += `
                    <div class="message ${msg.sender}">
                        ${msg.text}
                        <div class="message-time">${msg.time}</div>
                    </div>
                `;
            });
            
            html += `
                    </div>
                    <div class="input-group">
                        <input type="text" class="input-field" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." id="chatInput">
                    </div>
                    <button class="btn btn-small" onclick="sendMessage()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                </div>
            `;
            
            document.getElementById('content').innerHTML = html;
            
            // –°–∫—Ä–æ–ª–ª –≤–Ω–∏–∑
            setTimeout(() => {
                const chatDiv = document.getElementById('chatMessages');
                if (chatDiv) chatDiv.scrollTop = chatDiv.scrollHeight;
            }, 100);
        }

        // ===============================
        // –§–£–ù–ö–¶–ò–ò –ú–ê–ì–ê–ó–ò–ù–ê
        // ===============================
        function openCase() {
            if (DB.currentUser.balance < 50) {
                alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤!');
                return;
            }
            
            DB.currentUser.balance -= 50;
            
            const prizes = [
                { type: 'money', value: 10, name: '10‚ÇΩ' },
                { type: 'money', value: 50, name: '50‚ÇΩ' },
                { type: 'money', value: 100, name: '100‚ÇΩ' },
                { type: 'money', value: 500, name: '500‚ÇΩ' },
                { type: 'money', value: 1000, name: '1000‚ÇΩ' },
                { type: 'money', value: 5000, name: '5000‚ÇΩ' },
                { type: 'subscription', name: 'PRO –Ω–∞ –º–µ—Å—è—Ü', value: 91 },
                { type: 'subscription', name: 'MAX –Ω–∞ –º–µ—Å—è—Ü', value: 120 },
                { type: 'discount', name: '–°–∫–∏–¥–∫–∞ 50%', value: 50 }
            ];
            
            const prize = prizes[Math.floor(Math.random() * prizes.length)];
            
            if (prize.type === 'money') {
                DB.currentUser.balance += prize.value;
                alert(`üéâ –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${prize.name}!`);
            } else if (prize.type === 'subscription') {
                const until = new Date();
                until.setMonth(until.getMonth() + 1);
                DB.currentUser.subscriptions.push({
                    id: 'sub_' + Date.now(),
                    name: prize.name,
                    until: until.toLocaleDateString(),
                    config: 'config_' + Math.random().toString(36).substring(7)
                });
                alert(`üéâ –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${prize.name}!`);
            } else {
                alert(`üéâ –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${prize.name}!`);
            }
            
            updateUI();
        }

        function buyTariff(tariff) {
            const prices = { pro: 91, max: 120, router: 8000 };
            const names = { pro: 'PRO', max: 'MAX', router: 'ROUTER' };
            
            if (DB.currentUser.balance < prices[tariff]) {
                alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤!');
                return;
            }
            
            DB.currentUser.balance -= prices[tariff];
            
            const until = new Date();
            until.setMonth(until.getMonth() + 1);
            
            DB.currentUser.subscriptions.push({
                id: 'sub_' + Date.now(),
                name: names[tariff],
                until: until.toLocaleDateString(),
                config: 'config_' + Math.random().toString(36).substring(7)
            });
            
            alert(`‚úÖ –¢–∞—Ä–∏—Ñ ${names[tariff]} –∫—É–ø–ª–µ–Ω!`);
            updateUI();
        }

        // ===============================
        // –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–¨
        // ===============================
        function showAdminPanel() {
            if (!DB.admin.isLoggedIn) {
                const pwd = prompt('–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∞:');
                if (pwd === DB.admin.password) {
                    DB.admin.isLoggedIn = true;
                } else {
                    alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!');
                    return;
                }
            }
            
            let html = `
                <div class="tabs">
                    <button class="tab active" onclick="showAdminTab('users')">üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</button>
                    <button class="tab" onclick="showAdminTab('support')">üí¨ –ü–æ–¥–¥–µ—Ä–∂–∫–∞</button>
                    <button class="tab" onclick="showAdminTab('stats')">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
                </div>
                <div id="adminContent"></div>
            `;
            
            document.getElementById('content').innerHTML = html;
            showAdminTab('users');
        }

        function showAdminTab(tab) {
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            const container = document.getElementById('adminContent');
            
            if (tab === 'users') {
                let html = '<div class="admin-panel">';
                DB.users.forEach(user => {
                    html += `
                        <div class="user-row">
                            <div>
                                <div><strong>${user.name}</strong> (${user.id})</div>
                                <div style="font-size:12px;">IP: ${user.ip} | –ì–æ—Ä–æ–¥: ${user.city}</div>
                                <div style="font-size:12px;">–ë–∞–ª–∞–Ω—Å: ${user.balance}‚ÇΩ | –†–µ—Ñ: ${user.refCount}</div>
                            </div>
                            <div style="display:flex; gap:5px;">
                                ${!user.isBanned ? 
                                    `<button class="btn-small" onclick="banUser('${user.id}')">üö´ –ë–∞–Ω</button>` :
                                    `<button class="btn-small" onclick="unbanUser('${user.id}')">‚úÖ –†–∞–∑–±–∞–Ω</button>`
                                }
                                <button class="btn-small" onclick="addBalanceToUser('${user.id}')">üí∞ +</button>
                            </div>
                        </div>
                    `;
                });
                html += '</div>';
                container.innerHTML = html;
            } else if (tab === 'support') {
                let html = '<div class="admin-panel">';
                DB.supportChats.forEach(chat => {
                    const user = DB.users.find(u => u.id === chat.userId);
                    if (!user) return;
                    
                    html += `
                        <div class="user-row" onclick="openAdminChat('${user.id}')">
                            <div>
                                <div><strong>${user.name}</strong></div>
                                <div style="font-size:12px;">–°–æ–æ–±—â–µ–Ω–∏–π: ${chat.messages.length}</div>
                            </div>
                            <div>üëâ</div>
                        </div>
                    `;
                });
                html += '</div>';
                container.innerHTML = html;
            } else if (tab === 'stats') {
                const totalUsers = DB.users.length;
                const totalBalance = DB.users.reduce((sum, u) => sum + u.balance, 0);
                const totalRefs = DB.users.reduce((sum, u) => sum + u.refCount, 0);
                
                html = `
                    <div class="admin-panel">
                        <div class="grid-2">
                            <div class="price-card">
                                <div>üë• –í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                                <div class="price">${totalUsers}</div>
                            </div>
                            <div class="price-card">
                                <div>üí∞ –í—Å–µ–≥–æ –±–∞–ª–∞–Ω—Å–∞</div>
                                <div class="price">${totalBalance}‚ÇΩ</div>
                            </div>
                            <div class="price-card">
                                <div>ü§ù –†–µ—Ñ–µ—Ä–∞–ª–æ–≤</div>
                                <div class="price">${totalRefs}</div>
                            </div>
                            <div class="price-card">
                                <div>üì¶ –ü–æ–¥–ø–∏—Å–æ–∫</div>
                                <div class="price">${DB.users.reduce((sum, u) => sum + u.subscriptions.length, 0)}</div>
                            </div>
                        </div>
                    </div>
                `;
                container.innerHTML = html;
            }
        }

        // –ê–¥–º–∏–Ω-—Ñ—É–Ω–∫—Ü–∏–∏
        function banUser(userId) {
            const user = DB.users.find(u => u.id === userId);
            if (user) {
                user.isBanned = true;
                alert(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${user.name} –∑–∞–±–∞–Ω–µ–Ω`);
                showAdminTab('users');
            }
        }

        function unbanUser(userId) {
            const user = DB.users.find(u => u.id === userId);
            if (user) {
                user.isBanned = false;
                alert(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${user.name} —Ä–∞–∑–±–∞–Ω–µ–Ω`);
                showAdminTab('users');
            }
        }

        function addBalanceToUser(userId) {
            const amount = prompt('–°–∫–æ–ª—å–∫–æ –¥–æ–±–∞–≤–∏—Ç—å?');
            if (amount && !isNaN(amount)) {
                const user = DB.users.find(u => u.id === userId);
                if (user) {
                    user.balance += parseInt(amount);
                    alert(`–ë–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${user.name} –ø–æ–ø–æ–ª–Ω–µ–Ω –Ω–∞ ${amount}‚ÇΩ`);
                    showAdminTab('users');
                }
            }
        }

        function openAdminChat(userId) {
            const user = DB.users.find(u => u.id === userId);
            const chat = DB.supportChats.find(c => c.userId === userId) || {
                userId: userId,
                messages: []
            };
            
            let html = `
                <div class="admin-panel">
                    <button class="btn-small" onclick="showAdminPanel()" style="margin-bottom:10px;">‚Üê –ù–∞–∑–∞–¥</button>
                    <div class="card-title">–ß–∞—Ç —Å ${user.name}</div>
                    <div class="chat-messages" id="adminChatMessages">
            `;
            
            chat.messages.forEach(msg => {
                html += `
                    <div class="message ${msg.sender}">
                        ${msg.text}
                        <div class="message-time">${msg.time}</div>
                    </div>
                `;
            });
            
            html += `
                    </div>
                    <div class="input-group">
                        <input type="text" class="input-field" placeholder="–û—Ç–≤–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞..." id="adminChatInput">
                    </div>
                    <button class="btn-small" onclick="sendAdminMessage('${userId}')">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                </div>
            `;
            
            document.getElementById('adminContent').innerHTML = html;
            
            setTimeout(() => {
                const chatDiv = document.getElementById('adminChatMessages');
                if (chatDiv) chatDiv.scrollTop = chatDiv.scrollHeight;
            }, 100);
        }

        function sendAdminMessage(userId) {
            const input = document.getElementById('adminChatInput');
            if (!input.value.trim()) return;
            
            let chat = DB.supportChats.find(c => c.userId === userId);
            if (!chat) {
                chat = { userId, messages: [] };
                DB.supportChats.push(chat);
            }
            
            chat.messages.push({
                sender: 'admin',
                text: input.value,
                time: new Date().toLocaleTimeString()
            });
            
            localStorage.setItem('supportChats', JSON.stringify(DB.supportChats));
            input.value = '';
            openAdminChat(userId);
        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            if (!input.value.trim()) return;
            
            let chat = DB.supportChats.find(c => c.userId === DB.currentUser.id);
            if (!chat) {
                chat = { userId: DB.currentUser.id, messages: [] };
                DB.supportChats.push(chat);
            }
            
            chat.messages.push({
                sender: 'user',
                text: input.value,
                time: new Date().toLocaleTimeString()
            });
            
            localStorage.setItem('supportChats', JSON.stringify(DB.supportChats));
            input.value = '';
            showHelp();
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!');
            });
        }

        function cancelSub(subId) {
            DB.currentUser.subscriptions = DB.currentUser.subscriptions.filter(s => s.id !== subId);
            updateUI();
        }

        // ===============================
        // –ó–ê–ü–£–°–ö
        // ===============================
        window.onload = init;
    </script>
</body>
  </html>
